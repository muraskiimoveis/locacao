<html>
<head>
<?php
include("style.php");
?>
</head>
<body topmargin=0 leftmargin=0 rightmargin=0>
<table width=100% height=100%>
<tr><td valign=top>
<?php
	//$referencia = explode("_", $HTTP_REFERER);
	//echo $referencia[0];
	
	//if((session_is_registered("valid_user")) and (session_is_registered("u_tipo")) and (($u_tipo == "admin") or ($u_tipo == "func"))){
	if(($HTTP_SERVER_VARS['SERVER_NAME'] == "rebri.com.br") and ($referencia == "banner.php")){
?>
<br>
<?php
function retira_acentos( $name ) 
{ 
  $array1 = array(   "б", "а", "в", "г", "д", "й", "и", "к", "л", "н", "м", "о", "п", "у", "т", "ф", "х", "ц", "ъ", "щ", "ы", "ь", "з" 
                     , "Б", "А", "В", "Г", "Д", "Й", "И", "К", "Л", "Н", "М", "О", "П", "У", "Т", "Ф", "Х", "Ц", "Ъ", "Щ", "Ы", "Ь", "З"," ","'","ґ","`","/","\\","~","^","Ё" ); 
  $array2 = array(   "a", "a", "a", "a", "a", "e", "e", "e", "e", "i", "i", "i", "i", "o", "o", "o", "o", "o", "u", "u", "u", "u", "c" 
                     , "A", "A", "A", "A", "A", "E", "E", "E", "E", "I", "I", "I", "I", "O", "O", "O", "O", "O", "U", "U", "U", "U", "C","_","_","_","_","_","_","_","_","_" ); 
  return str_replace( $array1, $array2, $name ); 
}

//Funзгo alterada nos cбlculos de altura e largura
function criar_thumbnail($origem,$destino='',$largura='',$pre='tn_',$formato='JPEG') { 

    switch($formato) 
    { 
        case 'JPEG': 
            $tn_formato = 'jpg'; 
            break; 
        case 'PNG': 
            $tn_formato = 'png'; 
            break; 
    } 
    $ext = split("[/\\.]",strtolower($origem)); 
    $n = count($ext)-1; 
    $ext = $ext[$n]; 

    $arr = split("[/\\]",$origem); 
    $n = count($arr)-1; 
    $arra = explode('.',$arr[$n]); 
    $n2 = count($arra)-1; 
    $tn_name = str_replace('.'.$arra[$n2],'',$arr[$n]); 
    $destino = $destino.$pre.$tn_name.'.'.$tn_formato; 

    if ($ext == 'jpg' || $ext == 'jpeg'){ 
        $im = imagecreatefromjpeg($origem); 
    }elseif($ext == 'png'){ 
        $im = imagecreatefrompng($origem); 
    }elseif($ext == 'gif'){ 
        return false; 
    } 
    $w = imagesx($im); 
    $h = imagesy($im); 
    if ($w > $h)
    { 
        $nw = $largura;
        $nh = ($h * $largura)/$w; 
    }else{
        //$nh = $largura; 
        $nh = 145;
        $nw = ($w * $nh)/$h; 
    } 
    if(function_exists('imagecopyresampled')) 
    { 
        if(function_exists('imageCreateTrueColor')) 
        { 
            $ni = imageCreateTrueColor($nw,$nh); 
        }else{ 
            $ni    = imagecreate($nw,$nh); 
        } 
        if(!@imagecopyresampled($ni,$im,0,0,0,0,$nw,$nh,$w,$h)) 
        { 
            imagecopyresized($ni,$im,0,0,0,0,$nw,$nh,$w,$h); 
        } 
    }else{ 
        $ni    = imagecreate($nw,$nh); 
        imagecopyresized($ni,$im,0,0,0,0,$nw,$nh,$w,$h); 
    } 
    if($tn_formato=='jpg'){ 
        imagejpeg($ni,$destino,60); 
    }elseif($tn_formato=='png'){ 
        imagepng($ni,$destino); 
    } 
}
 
/* how many upload slots? */ 
define("UPLOAD_SLOTS", 10); 

/* where to move the uploaded file(s) to? */ 
define("INCOMING", "$caminho_banner"); 

if($REQUEST_METHOD=="POST") 
{

    /* handle uploads */ 
    $noinput = true; 
    for($i=1; $noinput && ($i<=UPLOAD_SLOTS); $i++) 
    { 
        if(${"infile".$i}!="none") $noinput=false; 
    } 
    if($noinput) 
    { 
        echo "error uploading. create 150MB coredump instead?"; 
        exit(); 
    } 


    for($i=1; $i<= UPLOAD_SLOTS; $i++) 
    { 
        if(${"infile".$i}){ 

	         $file = strtolower(${"infile".$i."_name"});
	         //$file = ${"infile".$i."_name"};
	         copy(${"infile".$i}, INCOMING.${file});
	         $arquivo_novo = retira_acentos(${file});
	         rename(INCOMING.${file}, INCOMING.${arquivo_novo});
            echo "O arquivo <b><i>". $arquivo_novo." </i></b>foi enviado com sucesso.<br><br>";
            
		//$nome_foto = ${"infile".$i."_name"};
		$nome_foto = $arquivo_novo;
		$rest = substr($nome_foto, -4);
		$nome_foto2 = str_replace(".jpg","_peq.jpg","$nome_foto");
		
	/*
	//if (file_exists("$caminho_banner$nome_foto"))
	if($rest == ".jpg")
	{
		
		$origem = "$caminho_banner" . $nome_foto;
		$dest = "/home/httpd/htdocs/adunarbr/img_dest/" . $nome_foto2;
		
	$ImageSize = GetImageSize ($origem);
	$Img_w = $ImageSize[0];
	$Img_h = $ImageSize[1];
	if(($Img_w > 175)  and ($Img_h <= 145)){
		$largura = "117";
	}
	elseif(($Img_w/$Img_h) > 1.42){
		$largura = "175";
	}
	else
	{
		$largura = $Img_w;
		$novoh = 145;
    $largura = ($Img_w * $novoh)/$Img_h;
	}

// exemplo 
//criar_thumbnail('/home/httpd/htdocs/adunarbr/img_dest/','/home/httpd/htdocs/bruccobr/img_insp/','300','tn_','JPEG'); 
criar_thumbnail($origem,$dest,$largura,'','JPEG');
rename($dest.$nome_foto, $dest);

	}//if exists
	*/
            
        }
    }

    echo '<br><br><a href="javascript:history.back()" class=linkm><< Voltar <<</a>';
} /* else */ 
?> 
<?php
	}
	else
	{
?>
<?php
include("login2.php");
?>
<?php
	}
?>
<?php
include("carimbo.php");
//mysql_close($con);
?>
</td></tr></table>
</body>
</html>